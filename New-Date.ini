

#[2025-10-31 12:31]


def extract_dates(input_path, history_path, output_path):
    with open(input_path, "r", encoding="utf-8") as file:
        lines = file.readlines()
    
    # ØªØºÛŒÛŒØ± 1: Ø§Ù„Ú¯ÙˆÛŒ Regex Ø¨Ø±Ø§ÛŒ ÙØ±Ù…Øª [YYYY-MM-DD HH:MM] Ø¢Ù¾Ø¯ÛŒØª Ø´Ø¯
    # (\d{4}) Ø¨Ø±Ø§ÛŒ Ø³Ø§Ù„ØŒ (\d{2}) Ø¨Ø±Ø§ÛŒ Ù…Ø§Ù‡ Ùˆ Ø±ÙˆØ²
    dates = re.findall(r"\[(\d{4})-(\d{2})-(\d{2}) (\d{2}:\d{2})\]", "".join(lines))
    
    converted_dates = []
    miladi_dates = []
    
    # ØªØºÛŒÛŒØ± 2: ØªØ±ØªÛŒØ¨ Ù…ØªØºÛŒØ±Ù‡Ø§ Ø¯Ø± ÙØ±Ù…Øª Ø¬Ø¯ÛŒØ¯ (Ø³Ø§Ù„ØŒ Ù…Ø§Ù‡ØŒ Ø±ÙˆØ²ØŒ Ø²Ù…Ø§Ù†) Ø§Ø³Øª
    for year, month, day, time in dates:
        year_full = int(year)       # Ø³Ø§Ù„ Ø¯ÛŒÚ¯Ø± Ù†ÛŒØ§Ø²ÛŒ Ø¨Ù‡ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† "20" Ù†Ø¯Ø§Ø±Ø¯
        month_num = int(month)      # Ù…Ø§Ù‡ Ù‡Ù…â€ŒØ§Ú©Ù†ÙˆÙ† Ø¹Ø¯Ø¯ Ø§Ø³Øª
        day_num = int(day)
        
        miladi_date = datetime(year_full, month_num, day_num)
        shamsi_date = JalaliDate(miladi_date).strftime("%Y/%m/%d")
        miladi_dates.append(miladi_date)
        
        # Ø¨Ø±Ø§ÛŒ Ù†Ù…Ø§ÛŒØ´ Ù†Ø§Ù… Ù…Ø§Ù‡ (Ù…Ø«Ù„ Oct) Ø¯Ø± Ø®Ø±ÙˆØ¬ÛŒ Ù…ØªÙ†ÛŒØŒ Ø¢Ù† Ø±Ø§ Ø§Ø² ØªØ§Ø±ÛŒØ® ØªÙˆÙ„ÛŒØ¯ Ù…ÛŒâ€ŒÚ©Ù†ÛŒÙ…
        month_name = miladi_date.strftime("%b") 

        converted_dates.append(
        f"__________________\n"
        f"{day_num} {month_name} {year_full}\n"      # Ù†Ù…Ø§ÛŒØ´ Ø¨Ù‡ ØµÙˆØ±Øª: 31 Oct 2025
        f"{day}-{month}-{year} {time}\n"             # Ù†Ù…Ø§ÛŒØ´ ÙØ±Ù…Øª Ø¹Ø¯Ø¯ÛŒ
        f"{shamsi_date}\n"
        f"__________________\n")

    with open(history_path, "w", encoding="utf-8") as file:
        file.writelines(converted_dates)
    
    if miladi_dates:
        first_date = miladi_dates[0]
        last_date = miladi_dates[-1]
        date_diff = (last_date - first_date).days
        first_shamsi = JalaliDate(first_date).strftime("%Y/%m/%d")
        last_shamsi = JalaliDate(last_date).strftime("%Y/%m/%d")
        
        with open(output_path, "a", encoding="utf-8") as file:
            file.write("____________________________________\n")
            file.write("ğŸ“…\n")
            file.write("Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ Ø§Ø² ØªØ§Ø±ÛŒØ®:\n")
            file.write(f"{first_shamsi}\n")
            file.write(f"{first_date.strftime('%d %b %Y')}\n")
            file.write("ØªØ§ ØªØ§Ø±ÛŒØ®:\n")
            file.write(f"{last_shamsi}\n")
            file.write(f"{last_date.strftime('%d %b %Y')}\n")
            file.write(f"ÙØ§ØµÙ„Ù‡ Ø²Ù…Ø§Ù†ÛŒ: {date_diff} Ø±ÙˆØ²\n")