در کد زیر تاریخچه را 
به صورت زیر نمایش میدهد:
دوره زمانی: 01-Feb-25 تا 31-Jan-25 (-1 روز)
بهتر نیست ابتدا تمام خطوط مربوط به تاریخ که در فایل input.txt قرار دارند، ابتدا در فایل:
D:\AVIDA\CODE\Invoice\History.txt
استخراج و ذخیره گردند و سپس فایل منننننن مورد بررسی قرار گیرد و دوره زمانی تصحیح گردد

import re
from datetime import datetime

def remove_titles(line):
    # تغییر الگو به طوری که هر تاریخ [dd-MMM-yy] در هر جایی از خط استخراج شود
    title_pattern = r"\[(\d{2}-\w{3}-\d{2})\s\d{2}:\d{2}\]"
    match = re.search(title_pattern, line.strip())
    if match:
        return "", match.group(1)  # بازگشت تاریخ استخراج شده
    return line, None  # در صورت عدم تطابق، خط را بدون تغییر برمی‌گرداند

def process_text(line, counts):
    if not any(keyword in line for keyword in ["تمدید شد ✅", "تمدید شد✅", "🟢"]):
        return None  # فقط خطوط حاوی این عبارات پردازش می‌شوند
    
    if "شصد گیگ" in line:
        if "سی روز" in line:
            line = line.replace("✅", "✅  [78]")
        elif "شصد روز" in line:
            line = line.replace("✅", "✅  [90]")
        elif "نود روز" in line:
            line = line.replace("✅", "✅  [105]")
        else:
            line = line.replace("✅", "✅  [000000]")
    
    if "هفتاد گیگ" in line:
        if "سی روز" in line:
            line = line.replace("✅", "✅  [91]")
        else:
            line = line.replace("✅", "✅  [000000]")
    
    if "هشتاد گیگ" in line:
        if "سی روز" in line:
            line = line.replace("✅", "✅  [104]")
        elif "شصد روز" in line:
            line = line.replace("✅", "✅  [110]")
        else:
            line = line.replace("✅", "✅  [000000]")
    
    if "نود گیگ" in line:
        if "سی روز" in line:
            line = line.replace("✅", "✅  [117]")
        elif "شصد روز" in line:
            line = line.replace("✅", "✅  [125]")
        elif "نود روز" in line:
            line = line.replace("✅", "✅  [135]")
        else:
            line = line.replace("✅", "✅  [000000]")
    
    if "صد گیگ" in line:
        if "سی روز" in line or "شصد روز" in line:
            line = line.replace("✅", "✅  [130]")
        elif "نود روز" in line:
            line = line.replace("✅", "✅  [150]")
        else:
            line = line.replace("✅", "✅  [000000]")
    
    if "صد و بیست گیگ" in line:
        if "سی روز" in line or "شصد روز" in line:
            line = line.replace("✅", "✅  [156]")
        elif "نود روز" in line:
            line = line.replace("✅", "✅  [165]")
        else:
            line = line.replace("✅", "✅  [000000]")
    
    if "صد و پنجاه گیگ" in line:
        if "سی روز" in line or "شصد روز" in line or "نود روز" in line:
            line = line.replace("✅", "✅  [195]")
        else:
            line = line.replace("✅", "✅  [000000]")
    
    replacements = {
        "ده گیگ": "✅  [25]",
        "بیست گیگ": "✅  [35]",
        "سی گیگ": "✅  [45]",
        "چهل گیگ": "✅  [55]",
        "پنجاه گیگ": "✅  [65]",
        "صدو بیست گیگ": "✅  [000000]",
        "صدو پنجاه گیگ": "✅  [000000]"
    }
    
    modified = False
    needs_review = False
    for key, value in replacements.items():
        if key in line:
            line = re.sub(r"✅", value, line)
            modified = True
            if "000000" in value:
                needs_review = True
    
    if "🟢" in line:
        line = line.replace("🟢", "🟢  [000000]")
        needs_review = True
        modified = True
    
    if modified:
        counts['total'] += 1
    
    if needs_review:
        counts['needs_review'] += 1

    # شمارش تعداد "✅" و "🟢"
    counts['total_checkmarks'] += line.count("✅")
    counts['total_green'] += line.count("🟢")
    
    return line

def calculate_date_diff(start_date, end_date):
    date_format = "%d-%b-%y"
    start = datetime.strptime(start_date, date_format)
    end = datetime.strptime(end_date, date_format)
    return (end - start).days

def main():
    input_path = "D:\\AVIDA\\CODE\\Invoice\\Input.txt"
    output_path = "D:\\AVIDA\\CODE\\Invoice\\Output.txt"
    editme_path = "D:\\AVIDA\\CODE\\Invoice\\EditMe.txt"

    counts = {
        "total": 0,
        "needs_review": 0,
        "sum": 0,
        "actual_total": 0,
        "total_checkmarks": 0,  # تعداد "✅"
        "total_green": 0  # تعداد "🟢"
    }
    processed_lines = []
    review_lines = []
    dates = []
    
    # استخراج تاریخ‌ها از فایل ورودی
    date_pattern = r"\[(\d{2}-\w{3}-\d{2})"
    with open(input_path, "r", encoding="utf-8") as file:
        lines = file.readlines()
    
    for line in lines:
        line, date = remove_titles(line)
        if date:
            dates.append(date)
        
        processed_line = process_text(line, counts)
        if processed_line:
            processed_lines.append(processed_line)
            
            if "[000000]" in processed_line:
                review_lines.append(processed_line)
            
            matches = re.findall(r"\[(\d+)\]", processed_line)
            for match in matches:
                if match != "000000":
                    counts['sum'] += int(match)
    
    counts['actual_total'] = counts['total']
    
    # اصلاح ترتیب تاریخ‌ها
    if dates:
        start_date = min(dates)
        end_date = max(dates)
    else:
        start_date = end_date = "نامشخص"
    
    # محاسبه تفاوت روزها
    if start_date != "نامشخص" and end_date != "نامشخص":
        date_diff = calculate_date_diff(start_date, end_date)
    else:
        date_diff = 0
    
    processed_lines.append(f"\nدوره زمانی: {start_date} تا {end_date} ({date_diff} روز)\n")
    processed_lines.append(f"تعداد کل ✅: {counts['total_checkmarks']}\n")
    processed_lines.append(f"تعداد کل 🟢: {counts['total_green']}\n")
    processed_lines.append(f"مجموع رکوردها: {counts['total_checkmarks'] + counts['total_green']}\n")  # مجموع "✅" و "🟢"
    processed_lines.append(f"تعداد رکوردهایی که نیاز به بررسی دارد: {counts['needs_review']} عدد\n")
    
    with open(output_path, "w", encoding="utf-8") as file:
        file.writelines(processed_lines)
    
    with open(editme_path, "w", encoding="utf-8") as file:
        file.writelines(review_lines)
        file.write(f"\nتعداد رکوردهایی که نیاز به بررسی دارد: {counts['needs_review']} عدد\n")
    
    # انتقال خط "جمع کل:" به آخرین خط
    with open(output_path, "a", encoding="utf-8") as file:
        file.write(f"جمع کل: {counts['sum']} هزار تومان\n")
    
if __name__ == "__main__":
    main()
