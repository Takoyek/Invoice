# [05-May-25 18:05]
def extract_dates(input_path, history_path, output_path):
    with open(input_path, "r", encoding="utf-8") as file:
        lines = file.readlines()
    
    dates = re.findall(r"\[(\d{2})-([A-Za-z]{3})-(\d{2}) (\d{2}:\d{2})\]", "".join(lines))
    
    month_map = {"Jan": "01", "Feb": "02", "Mar": "03", "Apr": "04", "May": "05", "Jun": "06",
                 "Jul": "07", "Aug": "08", "Sep": "09", "Oct": "10", "Nov": "11", "Dec": "12"}
    
    converted_dates = []
    miladi_dates = []
    for day, month, year, time in dates:
        year_full = int("20" + year)
        month_num = month_map[month]
        day = int(day)
        
        miladi_date = datetime(year_full, int(month_num), day)
        shamsi_date = JalaliDate(miladi_date).strftime("%Y/%m/%d")
        miladi_dates.append(miladi_date)
        
        converted_dates.append(
        f"__________________\n"
        f"{day} {month} {year_full}\n"
        f"{day}-{month_num}-{year_full} {time}\n"
        f"{shamsi_date}\n"
        f"__________________\n")

    with open(history_path, "w", encoding="utf-8") as file:
        file.writelines(converted_dates)
    
    if miladi_dates:
        first_date = miladi_dates[0]
        last_date = miladi_dates[-1]
        date_diff = (last_date - first_date).days
        first_shamsi = JalaliDate(first_date).strftime("%Y/%m/%d")
        last_shamsi = JalaliDate(last_date).strftime("%Y/%m/%d")
        
        with open(output_path, "a", encoding="utf-8") as file:
            file.write("____________________________________\n")
            file.write("ğŸ“…\n")
            file.write("Ø§ÛŒÙ† Ú¯Ø²Ø§Ø±Ø´ Ø§Ø² ØªØ§Ø±ÛŒØ®:\n")
            file.write(f"{first_shamsi}\n")
            file.write(f"{first_date.strftime('%d %b %Y')}\n")
            file.write("ØªØ§ ØªØ§Ø±ÛŒØ®:\n")
            file.write(f"{last_shamsi}\n")
            file.write(f"{last_date.strftime('%d %b %Y')}\n")
            file.write(f"ÙØ§ØµÙ„Ù‡ Ø²Ù…Ø§Ù†ÛŒ: {date_diff} Ø±ÙˆØ²\n")